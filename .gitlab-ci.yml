image: maven:latest

stages:
  - build
  - test
  - report

build:
  stage: build
  script:
    - mvn package

test:
  stage: test
  script:
    - mvn dependency::tree
    - mvn test -e

coverage:
  stage: report
  script:
    - mvn install -B
    - cat target/site/jacoco/index.html
  coverage: '/Total.*?ctr2.*?ctr2">([0-9]{1,3})%/'
  artifacts:
    name: test_coverage
    paths:
      - target/site/jacoco/

checkstyle:
  stage: report
  script:
    - mvn site -B
  artifacts:
    name: checkstyle
    paths:
      - checkstyle.html
      - css/
      - images/
